<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partidos</title>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/styles.css') }}">
    <style>
        .filter-container {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            display: inline-block;
        }
        .filter-container label {
            margin-right: 10px;
            font-weight: bold;
        }
        .filter-container input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .filter-container button {
            padding: 5px 10px;
            background-color: #000080;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .filter-container button:hover {
            background-color: #0000a0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1 style="color: #ff0000;">PARTIDOS</h1>
    <div class="filter-container">
        <form method="get" action="/partidos/">
            <label for="year_filter">Buscar por Año:</label>
            <input type="number" id="year_filter" name="year" placeholder="Ej. 2021" value="{{ request.query_params.get('year') or '' }}">
            <button type="submit">Filtrar</button>
        </form>
    </div>
    <table>
        <thead>
            <tr style="background-color: #000080; color: white;">
                <th>ID</th>
                <th>FECHA</th>
                <th>EQUIPO LOCAL</th>
                <th>EQUIPO VISITANTE</th>
                <th>GOLES LOCAL</th>
                <th>GOLES VISITANTE</th>
                <th>TORNEO</th>
                <th>ELIMINADO</th>
                <th>TARJETAS AMARILLAS</th>
                <th>TARJETAS ROJAS</th>
                <th>ACCIONES</th>
            </tr>
        </thead>
        <tbody>
            {% for partido in partidos %}
            {% set matching_torneo = torneos|selectattr('id', 'eq', partido.torneo_id)|first %}
            {% if not request.query_params.get('year') or (matching_torneo and matching_torneo.anio == request.query_params.get('year')|int) %}
            <tr>
                <td>{{ partido.id }}</td>
                <td>{{ partido.fecha }}</td>
                <td>{{ partido.equipo_local }}</td>
                <td>{{ partido.equipo_visitante }}</td>
                <td>{{ partido.goles_local }}</td>
                <td>{{ partido.goles_visitante }}</td>
                <td>{{ matching_torneo.nombre if matching_torneo else 'Sin torneo' }}</td>
                <td>{{ partido.eliminado or 'No' }}</td>
                <td>{{ partido.tarjetas_amarillas_local + partido.tarjetas_amarillas_visitante }}</td>
                <td>{{ partido.tarjetas_rojas_local + partido.tarjetas_rojas_visitante }}</td>
                <td>
                    <a href="/partidos/{{ partido.id }}/edit" class="btn-edit">Editar</a>
                    <a href="/partidos/{{ partido.id }}/delete" class="btn-delete">Eliminar</a>
                    <a href="/partidos/crear/" class="btn-add">Añadir</a>
                </td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</body>
</html>